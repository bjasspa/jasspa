<HTML>
<HEAD><TITLE>Client-Server(2)</TITLE></HEAD>
<!-- nr2html - Version 1.0.1f - [Nroff Parser : 1.3.4 (Win32)] - Jan 25 2000 - Jon Green (1995-97) -->
<BODY>
<H1><A HREF="../me.html"><IMG SRC="../me/logo.gif" ALIGN=BOTTOM ALT="[me]"></A>
Client-Server(2)</H1>
<FONT SIZE=2>
<A HREF="../me.html">[Home]</A>
<A HREF="amicr031.html">[Commands]</A>
<A HREF="amicr033.html">[Variables]</A>
<A HREF="amicr034.html">[Macro-Dev]</A>
<A HREF="amicr035.html">[Glossary]</A>
</FONT>
<HR>
<H2><B>CLIENT-SERVER </B></H2>
<UL><P>This sections describes how MicroEmacs '02 may be interfaced to external components through the <B>Client-Server</B> interface. 
<P>The <B>Client-Server</B> interface of MicroEmacs '02 provides a capability for other applications to inject commands into a running version of the editor, which are interpreted and executed. The interface is only available on multi-tasking operating systems such as UNIX and Microsoft Windows; it is not available on MS-DOS systems. 
<P>Within the following discussions, the <B>Server</B> is a running version of the MicroEmacs '02 editor; the <B>client</B> is the application (or shell script) that communicates a new command to the <I>server</I>. 
<P>The <B>Client-Server</B> interface may provide a bidirectional interface such that a <I>client</I> may submit a command to the <I>server</I> and may also retrieve a response to that command. </UL>
<H2><B>DESCRIPTION </B></H2>
<UL><P>The <B>Client-Server</B> interface operates by making an external interface available which is continually monitored by the <I>server</I>. The external interface may be provided by a file, named pipe or socket (depending upon the platform) with a well know location in the file system. Typically two files are provided, an input file into which the <I>client</I> writes commands (<I>$TEMP</I><B>/me</B><I>$MENAME</I><B>.cmd</B>); and an output file where responses to those commands my be read (<I>$TEMP</I><B>/me</B><I>$MENAME</I><B>.rsp</B>). 
<P>Within MicroEmacs, the client server interface appears as a hidden 
<A HREF="m2cmd077.html">ipipe-shell-command(2)</A> buffer, with the name <TT>*server*</TT>. Commands are received through this buffer and responses are written back to the buffer. </UL>
<H2>Client Commands </H2>
<UL><P><I>Clients</I> may write directly to the <I>command</I> through the use of explicit embedded code, or may use a 
<A HREF="m1cmd000.html">me(1)</A> invocation with the <B>-m</B> option. Commands to the client interface take the form &quot;<B>C:</B><I>&lt;client&gt;</I><B>:</B><I>&lt;command&gt;</I>&quot;. 
<P><I>&lt;client&gt;</I> 
<BR><UL><I>&lt;client&gt;</I> is an identification string that may be used to identify the client, this information may be used when the command is handled to interpret the command if some special client specific action is required. </UL>
<P><I>&lt;command&gt;</I> 
<BR><UL>The <I>&lt;command&gt;</I> is an editor command (or macro) of the given name with any arguments. Standard command escape sequences must be adhered to. i.e. to write &quot;<TT>Hello World</TT>&quot; on the message line then a client may issue the command:- <UL>
<PRE>me&nbsp;-m&nbsp;&quot;C:&lt;client&gt;:ml-write&nbsp;\&quot;Hello&nbsp;world\&quot; 
</PRE></UL>
</UL><UL><P>The <I>client-server</I> interface is typically used to load a file, this may be performed as follows:- <UL>
<PRE>me&nbsp;-m&nbsp;&quot;C:&lt;client&gt;:find-file&nbsp;\&quot;/path/foo.bar\&quot;&quot; 
</PRE></UL>
</UL><UL><P>The absolute path is specified in this type of transaction as the current working directory of the active MicroEmacs session is unknown. The <B>-m</B> option de-iconize's the existing editor session and bring it to the foreground. </UL></UL>
<H2>Client Responses </H2>
<UL><P>Responses from <I>client</I> commands are written to the response file, responses take a similar form to <I>client</I> commands except they are prefixed by an <B>R</B>, i.e. &quot;<B>R:</B><I>&lt;client&gt;</I><B>:</B><I>&lt;data&gt;</I>&quot;. 
<P>As multiple <I>clients</I> may be utilizing the <I>client-server</I> mechanism then the <I>&lt;client&gt;</I> sting passed in the command is typically returned in the response to allow the <I>client</I> to identify it's own response (rather than any other <I>clients</I>. It is the <I>clients</I> responsibility that this string is unique in order that it may be differentiated. 
<P>The returned <I>&lt;data&gt;</I> format is undefined and would be generated by a macro command used to handle the <I>client</I> command; sufficient to say that the data should exist on a single line. </UL>
<H2>Server Side </H2>
<UL><P>On the <I>server</I> side, the <B>Client-Server</B> interface is managed like an 
<A HREF="m2cmd077.html">ipipe-shell-command(2)</A> using the hidden buffer <TT>*server*</TT> (as previously mentioned). 
<P>The <I>Client-Server</I> interface is enabled from the 
<A HREF="m3osd000.html">user-setup(3)</A> interface, the user setting of the interface is confirmed by checking bit <TT>0x20000</TT> of the 
<A HREF="m5var047.html">$system(5)</A> variable. 
<P>The client server interface is typically initialized within the <TT>me.emf</TT> initialization file, whereby the <I>ipipe</I> input handler is bound to the client pipe buffer and the buffer is hidden, so it is not available when the buffers are swapped. (Note that the client buffer may be explicitly interrogated using 
<A HREF="m2cmd091.html">find-buffer</A> <TT>*server*</TT>). The client handler is installed as follows:- <UL>
<PRE>;&nbsp;Setup&nbsp;the&nbsp;Client&nbsp;Server 
!if&nbsp;&amp;band&nbsp;$system&nbsp;0x20000 
&nbsp;&nbsp;&nbsp;&nbsp;define-macro-file&nbsp;meserver&nbsp;server-input 
&nbsp;&nbsp;&nbsp;&nbsp;find-buffer&nbsp;&quot;*server*&quot; 
&nbsp;&nbsp;&nbsp;&nbsp;set-variable&nbsp;:last-line&nbsp;2 
&nbsp;&nbsp;&nbsp;&nbsp;set-variable&nbsp;:client-list&nbsp;&quot;:&quot; 
&nbsp;&nbsp;&nbsp;&nbsp;set-variable&nbsp;$buffer-ipipe&nbsp;server-input 
&nbsp;&nbsp;&nbsp;&nbsp;beginning-of-buffer 
&nbsp;&nbsp;&nbsp;&nbsp;goto-alpha-mark&nbsp;&nbsp;&quot;I&quot; 
&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;find-buffer&nbsp;&quot;*server*&quot; 
!endif 
</PRE></UL>
<P>This binds a MicroEmacs macro called <I>server-input</I> to handle the client commands as they arrive on the input, an 
<A HREF="m2cmd059.html">alpha-mark</A> is used to record the processed position at the end of the buffer. The pipe handler itself decodes the client request and executes it. The default handler supplied with MicroEmacs '02 is defined within the macro file <TT>meserver.emf</TT> 
<P>Responses to the client are inserted into the response file by writing directly into the ipipe buffer (<TT>*server*</TT>) using the 
<A HREF="m2cmd077.html">ipipe-write(2)</A> command. It is the calling macros responsibility to ensure that the response string adheres to the format outlined above in the previous sections. </UL>
<H2><B>NOTES </B></H2>
<UL><P>It is not possible to kill the <TT>*server*</TT> buffer, and 
<A HREF="m2cmd077.html">ipipe-kill(2)</A> is ignored within the context of the buffer. </UL>
<H2><B>FILES </B></H2>
<UL><P><TT>meserver.emf</TT> - Default Client-Server ipipe handler. 
<BR><I>$TEMP</I><B>/me</B><I>$MENAME</I><B>.cmd</B> - Command file. 
<BR><I>$TEMP</I><B>/me</B><I>$MENAME</I><B>.rsp</B> - Response file. </UL>
<H2><B>BUGS </B></H2>
<UL><P>The first MicroEmacs '02 session that executes becomes the editor server, additional editor sessions that are executed do not become server processes. In the event that the <I>server</I> editor is terminated, any other sessions do not take over the role of server. Subsequently issuing a client command may fail, or invoke a new editor session which adopts the role of server. </UL>
<H2><B>SEE ALSO </B></H2>
<UL><P>
<A HREF="m1cmd000.html">me(1)</A>, 
<A HREF="m2cmd077.html">ipipe-shell-command(2)</A> </UL>
<HR>
<P><I>(c) Copyright JASSPA 2002</I>
<BR><I>Last Modified: 2001/12/18</I>
<BR><I>Generated On: 2002/01/06</I>
</BODY></HMTL>
