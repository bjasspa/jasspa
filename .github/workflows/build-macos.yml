name: Build macOS (macos-latest)

on:
  workflow_dispatch:
    branches: [ master ]

jobs:
  build:
    runs-on: macos-latest
    name: Build on ${{ matrix.distro }} ${{ matrix.arch }}

    steps:
    - name: Install dependencies
      run: |
         which cc
         cc --version
         which make
         make --version
         brew install xquartz
      
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Compile macos apple mec
      run: |
        mkdir downloads
        mkdir packages
        cd ./microemacs/src
        ./build.sh -t c -a apple
    - name: Compile macos apple mew
      run: |
        cd ./microemacs/src
        ./build.sh -t w -a apple
    - name: Create macos apple binaries download
      run: |
        cd ./microemacs/bin
        mv macos23-apple64-* macos23-apple64
        cd ..
        export MEVER=`./bin/macos23-apple64/mec -p @contribs/ver.emf`
        zip -r ../downloads/Jasspa_MicroEmacs_${MEVER}_macos23_apple64_binaries bin

    - name: Compile macos intel mec
      run: |
        cd ./microemacs/src
        ./build.sh -t c -a intel
    - name: Compile macos intel mew
      run: |
        cd ./microemacs/src
        ./build.sh -t w -a intel
    - name: Create macos apple binaries download
      run: |
        cd ./microemacs/bin
        mv macos23-intel64-* macos23-intel64
        cd ..
        export MEVER=`./bin/macos23-apple64/mec -p @contribs/ver.emf`
        zip -r ../downloads/Jasspa_MicroEmacs_${MEVER}_macos23_intel64_binaries bin/macos23-intel64
           
